<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gene Expression Box Plot</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
</head>
<body>
    <h1>Gene Expression Box Plot</h1>
    <p>Try refresh page if results can't show appropriately.</p>
    
    <div id="page1" class="page active">
        <h2>Cohort 1</h2>
        <label for="geneInput">Enter Gene Name:</label>
        <input type="text" id="geneInput">
        <button onclick="plotExpression()">Plot Expression</button>
        <div id="expressionChart" style="width: 800px; height: 400px;"></div>
        <div id="errorMessage" style="color: red;"></div>
    </div>
    <div id="page2" class="page">
        <h2>Cohort 2</h2>
        <!-- Add your content for Page 2 here -->
    </div>

    

    <script>
        function plotExpression() {
            // 获取基因名输入框的值
            var geneNameInput = document.getElementById('geneInput').value;

            Papa.parse('cohort1.csv', {
                download: true,
                header: true,
                complete: function(results, file) {
                    if (results.errors.length > 0) {
                        console.error('Error parsing CSV file:', results.errors);
                        return;
                    }

                    var cohort1 = results;

                    // 查找具有特定基因名的那一行
                    var selectedRow = cohort1.data.find(function(row) {
                        return row.geneName === geneNameInput;
                    });
                    if (!selectedRow) {
                        var selectedRow = cohort1.data.find(function(row){
                            return row.geneSymbol === geneNameInput;
                        });
                    }

                    // 检查是否找到了匹配的行
                    if (!selectedRow) {
                        var chartCanvas = document.getElementById('expressionChart');
                        if (chartCanvas) {
                            chartCanvas.parentNode.removeChild(chartCanvas);
                        }
                        document.getElementById('errorMessage').innerText = "Sorry, can't find this gene. Please ensure your input is the right pig ensembl name or gene name, e.g., ENSSSCG00000000002 or IL6";
                        console.log("Sorry, can't find this gene. Please ensure your input is the right pig ensembl name, e.g., ENSSSCG00000000131.");
                    } else {
                        document.getElementById('errorMessage').innerText = '';
                        // 提取第2到第17个数值，分配到分组1
                        var valuesGroup1 = Object.values(selectedRow).slice(1, 18);

                        // 提取第18到第31个数值，分配到分组2
                        var valuesGroup2 = Object.values(selectedRow).slice(18, 32);

                        // 提取第32到第41个数值，分配到分组3
                        var valuesGroup3 = Object.values(selectedRow).slice(32, 42);

                        // 提取第42到第59个数值，分配到分组4
                        var valuesGroup4 = Object.values(selectedRow).slice(42, 60);

                        // 创建 data 对象
                        var data = [
                            {
                                type: 'box',
                                y: valuesGroup1,
                                jitter: 0.3,
                                pointpos: -1.8,
                                boxpoints: 'all',
                                name: 'Resistance'
                            },
                            {
                                type: 'box',
                                y: valuesGroup2,
                                jitter: 0.3,
                                pointpos: -1.8,
                                boxpoints: 'all',
                                name: 'Resilience'
                            },
                            {
                                type: 'box',
                                y: valuesGroup3,
                                jitter: 0.3,
                                pointpos: -1.8,
                                boxpoints: 'all',
                                name: 'Susceptible'
                            },
                            {
                                type: 'box',
                                boxpoints: 'all',
                                y: valuesGroup4,
                                jitter: 0.3,
                                pointpos: -1.8,
                                name: 'Early_death'
                            }
                        ];

                        // 创建 layout 对象
                        var layout = {
                            title: 'Gene Expression Box Plot',
                            yaxis: {
                                title: 'Expression Level'
                            }
                        };

                        // 使用 Plotly.newPlot 创建箱线图
                        Plotly.newPlot('expressionChart', data, layout);
                    }
                }
            });
        }
    </script>
</body>
</html>
